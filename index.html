<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æƒ æ–¯é€šç”µæ¡¥æ¢è‡‚æ³•ç”µé˜»æµ‹é‡</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #e6f7ff, #b3e0ff, #80c7ff);
            color: #333;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            border: 1px solid #4dabf7;
        }

        h1 {
            font-size: 2.2rem;
            margin-bottom: 15px;
            color: #1976d2;
        }

        .measurement-conditions {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin: 25px 0;
            background: rgba(25, 118, 210, 0.1);
            padding: 20px;
            border-radius: 12px;
            border: 1px solid #90caf9;
        }

        .info-item {
            flex: 1;
            min-width: 200px;
        }

        .info-item label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #1565c0;
        }

        .info-item input {
            width: 100%;
            padding: 12px;
            border: 2px solid #90caf9;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.9);
            color: #333;
            font-size: 1rem;
        }

        .card {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(5px);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
            border: 1px solid #bbdefb;
        }

        .card-title {
            font-size: 1.4rem;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 12px;
            color: #0d47a1;
            padding-bottom: 10px;
            border-bottom: 2px solid #bbdefb;
        }

        .table-container {
            overflow-x: auto;
            margin: 20px 0;
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.95);
            border: 1px solid #bbdefb;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 1200px;
        }

        th, td {
            padding: 10px 2px;
            text-align: center;
            border: 1px solid #bbdefb;
        }

        th {
            width: 30px;
            background: rgba(66, 165, 245, 0.2);
            font-weight: 600;
            color: #0d47a1;
            position: sticky;
            top: 0;
        }

        td {
            background: rgba(255, 255, 255, 0.95);
        }

        input[type="text"], input[type="number"] {
            width: 60px;
            padding: 2px 2px;
            border: 1px solid #90caf9;
            border-radius: 5px;
            background: rgba(255, 255, 255, 0.95);
            color: #333;
            text-align: center;
        }

        input:focus {
            outline: none;
            border-color: #42a5f5;
            background: rgba(255, 255, 255, 1);
            box-shadow: 0 0 8px rgba(66, 165, 245, 0.3);
        }

        .result-cell {
            width: 50px;
            background: rgba(102, 187, 106, 0.2) !important;
            font-weight: bold;
            color: #2e7d32;
        }

        .button-group {
            display: flex;
            gap: 15px;
            margin: 25px 0;
            flex-wrap: wrap;
        }

        button {
            background: linear-gradient(45deg, #42a5f5, #64b5f6);
            color: white;
            border: none;
            padding: 12px 20px;
            font-size: 1rem;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            flex: 1;
            min-width: 180px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        button:hover {
            background: linear-gradient(45deg, #1e88e5, #42a5f5);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        button.reset {
            background: linear-gradient(45deg, #ef5350, #f44336);
        }

        button.reset:hover {
            background: linear-gradient(45deg, #e53935, #ef5350);
        }

        .visualization-container {
            display: flex;
            gap: 20px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .visualization {
            flex: 1;
            min-width: 300px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            border: 1px solid #bbdefb;
        }

        .formula-box {
            flex: 1;
            min-width: 300px;
            background: rgba(236, 239, 241, 0.8);
            padding: 15px;
            border-radius: 10px;
            border-left: 4px solid #42a5f5;
        }

        .chart-container {
            position: relative;
            height: 400px;
            width: 100%;
        }

        .formula-box h3 {
            color: #1565c0;
            margin-bottom: 10px;
        }

        .formula {
            font-family: 'Courier New', monospace;
            font-size: 1.1rem;
            color: #0d47a1;
            margin: 5px 0;
        }

        .instructions-container {
            display: flex;
            gap: 20px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .instructions {
            flex: 2;
            min-width: 300px;
            background: rgba(255, 255, 255, 0.9);
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            border: 1px solid #bbdefb;
        }

        .qr-code-container {
            flex: 1;
            min-width: 200px;
            background: rgba(255, 255, 255, 0.9);
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            border: 1px solid #bbdefb;
            text-align: center;
        }

        .qr-code-placeholder {
            margin-top: 15px;
        }

        .qr-code-placeholder img {
            width: 300px;
            height: 300px;
            margin-bottom: 15px;
            border: 1px solid #eee;
        }

        .qr-code-placeholder p {
            color: #1565c0;
            font-size: 0.9rem;
            margin-top: 10px;
        }

        .instructions h3 {
            color: #1565c0;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .instructions ol {
            padding-left: 25px;
        }

        .instructions li {
            margin-bottom: 12px;
            line-height: 1.6;
            color: #424242;
        }

        .global-r0 {
            background: rgba(66, 165, 245, 0.2);
            font-weight: bold;
            vertical-align: middle;
        }

        .ratio-cell {
            white-space: nowrap;
            font-weight: 500;
            color: #0d47a1;
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 1.8rem;
            }

            .table-container {
                overflow-x: scroll;
            }

            .measurement-conditions {
                flex-direction: column;
            }

            button {
                min-width: 100%;
            }
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-bolt"></i> æƒ æ–¯é€šç”µæ¡¥æ¢è‡‚æ³•ç”µé˜»æµ‹é‡</h1>
        </header>

        <div class="measurement-conditions">
            <div class="info-item">
                <label for="rough-value"><i class="fas fa-ruler"></i> ç²—æµ‹å€¼ (Î©)</label>
                <input type="text" id="rough-value" placeholder="">
            </div>
            <div class="info-item">
                <label for="current-constant"><i class="fas fa-tachometer-alt"></i> æ£€æµè®¡ç”µæµå¸¸æ•°</label>
                <input type="text" id="current-constant" placeholder="">
            </div>
            <div class="info-item">
                <label for="voltage"><i class="fas fa-bolt"></i> ç”µå‹ (V)</label>
                <input type="text" id="voltage" placeholder="">
            </div>
        </div>

        <div class="card">
            <h2 class="card-title"><i class="fas fa-table"></i> æƒ æ–¯é€šç”µæ¡¥å®éªŒæ•°æ®è®°å½•è¡¨</h2>

            <div class="table-container">
                <table id="measurement-table">
                    <thead>
                        <tr>
                            <th class="global-r0" rowspan="2">è®¾ç½®å…¨å±€Râ‚€<br><input type="number" id="global-r1" step="any" placeholder=""></th>
                            <th colspan="7">æ¢è‡‚å‰</th>
                            <th colspan="7">æ¢è‡‚å</th>
                            <th colspan="2">è®¡ç®—ç»“æœ</th>
                        </tr>
                        <tr>
                            <!-- æ¢è‡‚å‰ -->
                            <th>æ¡¥è‡‚æ¯”</th>
                            <th>Râ‚/Î©</th>
                            <th>Râ‚‚/Î©</th>
                            <th>Râ‚ƒ/Î©</th>
                            <th>Î”Râ‚ƒ/Î©</th>
                            <th>n/æ ¼</th>
                            <th>ğ‘†â‚(æ ¼/1%)</th>

                            <!-- æ¢è‡‚å -->
                            <th>æ¡¥è‡‚æ¯”</th>
                            <th>Râ‚/Î©</th>
                            <th>Râ‚‚/Î©</th>
                            <th>Râ‚ƒ'/Î©</th>
                            <th>Î”Râ‚ƒ/Î©</th>
                            <th>n/æ ¼</th>
                            <th>ğ‘†â‚‚(æ ¼/1%)</th>

                            <!-- è®¡ç®—ç»“æœ -->
                            <th>Râ‚“/Î©</th>
                            <th>Râ‚“=Râ‚“Â±Î”Râ‚“/Î©</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- 1:1 è¡Œ -->
                        <tr>
                            <td class="global-r0"></td>
                            <!-- æ¢è‡‚å‰ -->
                            <td class="ratio-cell">1:1</td>
                            <td><input type="number" class="r1-before" step="any"></td>
                            <td><input type="number" class="r2-before" step="any"></td>
                            <td><input type="number" class="r3-before" step="any"></td>
                            <td><input type="number" class="delta-r3-before" step="any"></td>
                            <td><input type="number" class="n-before" step="any"></td>
                            <td class="result-cell s1"></td>

                            <!-- æ¢è‡‚å -->
                            <td class="ratio-cell">1:1</td>
                            <td><input type="number" class="r1-after" step="any"></td>
                            <td><input type="number" class="r2-after" step="any"></td>
                            <td><input type="number" class="r3-after" step="any"></td>
                            <td><input type="number" class="delta-r3-after" step="any"></td>
                            <td><input type="number" class="n-after" step="any"></td>
                            <td class="result-cell s2"></td>

                            <!-- è®¡ç®—ç»“æœ -->
                            <td class="result-cell rx"></td>
                            <td class="result-cell rx-final"></td>
                        </tr>

                        <!-- 1:2 è¡Œ -->
                        <tr>
                            <td class="global-r0"></td>
                            <!-- æ¢è‡‚å‰ -->
                            <td class="ratio-cell">1:2</td>
                            <td><input type="number" class="r1-before" step="any"></td>
                            <td><input type="number" class="r2-before" step="any"></td>
                            <td><input type="number" class="r3-before" step="any"></td>
                            <td><input type="number" class="delta-r3-before" step="any"></td>
                            <td><input type="number" class="n-before" step="any"></td>
                            <td class="result-cell s1"></td>

                            <!-- æ¢è‡‚å -->
                            <td class="ratio-cell">2:1</td>
                            <td><input type="number" class="r1-after" step="any"></td>
                            <td><input type="number" class="r2-after" step="any"></td>
                            <td><input type="number" class="r3-after" step="any"></td>
                            <td><input type="number" class="delta-r3-after" step="any"></td>
                            <td><input type="number" class="n-after" step="any"></td>
                            <td class="result-cell s2"></td>

                            <!-- è®¡ç®—ç»“æœ -->
                            <td class="result-cell rx"></td>
                            <td class="result-cell rx-final"></td>
                        </tr>

                        <!-- 1:5 è¡Œ -->
                        <tr>
                            <td class="global-r0"></td>
                            <!-- æ¢è‡‚å‰ -->
                            <td class="ratio-cell">1:5</td>
                            <td><input type="number" class="r1-before" step="any"></td>
                            <td><input type="number" class="r2-before" step="any"></td>
                            <td><input type="number" class="r3-before" step="any"></td>
                            <td><input type="number" class="delta-r3-before" step="any"></td>
                            <td><input type="number" class="n-before" step="any"></td>
                            <td class="result-cell s1"></td>

                            <!-- æ¢è‡‚å -->
                            <td class="ratio-cell">5:1</td>
                            <td><input type="number" class="r1-after" step="any"></td>
                            <td><input type="number" class="r2-after" step="any"></td>
                            <td><input type="number" class="r3-after" step="any"></td>
                            <td><input type="number" class="delta-r3-after" step="any"></td>
                            <td><input type="number" class="n-after" step="any"></td>
                            <td class="result-cell s2"></td>

                            <!-- è®¡ç®—ç»“æœ -->
                            <td class="result-cell rx"></td>
                            <td class="result-cell rx-final"></td>
                        </tr>

                        <!-- 1:8 è¡Œ -->
                        <tr>
                            <td class="global-r0"></td>
                            <!-- æ¢è‡‚å‰ -->
                            <td class="ratio-cell">1:8</td>
                            <td><input type="number" class="r1-before" step="any"></td>
                            <td><input type="number" class="r2-before" step="any"></td>
                            <td><input type="number" class="r3-before" step="any"></td>
                            <td><input type="number" class="delta-r3-before" step="any"></td>
                            <td><input type="number" class="n-before" step="any"></td>
                            <td class="result-cell s1"></td>

                            <!-- æ¢è‡‚å -->
                            <td class="ratio-cell">8:1</td>
                            <td><input type="number" class="r1-after" step="any"></td>
                            <td><input type="number" class="r2-after" step="any"></td>
                            <td><input type="number" class="r3-after" step="any"></td>
                            <td><input type="number" class="delta-r3-after" step="any"></td>
                            <td><input type="number" class="n-after" step="any"></td>
                            <td class="result-cell s2"></td>

                            <!-- è®¡ç®—ç»“æœ -->
                            <td class="result-cell rx"></td>
                            <td class="result-cell rx-final"></td>
                        </tr>

                        <!-- 1:10 è¡Œ -->
                        <tr>
                            <td class="global-r0"></td>
                            <!-- æ¢è‡‚å‰ -->
                            <td class="ratio-cell">1:10</td>
                            <td><input type="number" class="r1-before" step="any"></td>
                            <td><input type="number" class="r2-before" step="any"></td>
                            <td><input type="number" class="r3-before" step="any"></td>
                            <td><input type="number" class="delta-r3-before" step="any"></td>
                            <td><input type="number" class="n-before" step="any"></td>
                            <td class="result-cell s1"></td>

                            <!-- æ¢è‡‚å -->
                            <td class="ratio-cell">10:1</td>
                            <td><input type="number" class="r1-after" step="any"></td>
                            <td><input type="number" class="r2-after" step="any"></td>
                            <td><input type="number" class="r3-after" step="any"></td>
                            <td><input type="number" class="delta-r3-after" step="any"></td>
                            <td><input type="number" class="n-after" step="any"></td>
                            <td class="result-cell s2"></td>

                            <!-- è®¡ç®—ç»“æœ -->
                            <td class="result-cell rx"></td>
                            <td class="result-cell rx-final"></td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="button-group">
                <button class="reset" id="reset-button"><i class="fas fa-redo"></i> é‡ç½®è¡¨æ ¼æ•°æ®</button>
            </div>
        </div>

        <div class="visualization-container">
            <div class="visualization">
                <h2 class="card-title"><i class="fas fa-chart-line"></i> Sâ‚çµæ•åº¦å¯è§†åŒ–</h2>
                <div class="chart-container">
                    <canvas id="sensitivityChart"></canvas>
                </div>
            </div>
            
            <!-- å°†äºŒç»´ç æ¨¡å—ç§»åˆ°å…¬å¼æ¨¡å—å‰é¢ -->
            <div class="qr-code-container">
                <h3><i class="fas fa-qrcode"></i> æ‰«ç ä¸Šä¼ å®éªŒç»“æœ</h3>
                <div class="qr-code-placeholder">
                    <!-- è¿™é‡Œå¯ä»¥æ”¾ç½®å®é™…çš„äºŒç»´ç å›¾ç‰‡æˆ–ç”ŸæˆäºŒç»´ç  -->
                    <img src="my-qrcode.png" alt="äºŒç»´ç ">
                    <p>è¯·ä½¿ç”¨å¾®ä¿¡æ‰«æäºŒç»´ç </p>
                </div>
            </div>
        </div>

        <div class="instructions-container">
            <div class="instructions">
                <h3><i class="fas fa-info-circle"></i> ä½¿ç”¨è¯´æ˜</h3>
                <ol>
                    <li>åœ¨"æµ‹é‡æ¡ä»¶"éƒ¨åˆ†è¾“å…¥å®éªŒçš„åŸºæœ¬å‚æ•°</li>
                    <li>åœ¨"è®¾ç½®å…¨å±€Râ‚€"åˆ—è¾“å…¥å…¨å±€Râ‚€å€¼ï¼Œå°†è‡ªåŠ¨å¡«å……åˆ°å„è¡Œçš„Râ‚åˆ—</li>
                    <li>åœ¨è¡¨æ ¼ä¸­è¾“å…¥æ¢è‡‚å‰åçš„æµ‹é‡æ•°æ®</li>
                    <li>è®¡ç®—ç»“æœå°†è‡ªåŠ¨æ˜¾ç¤ºåœ¨å³ä¾§åˆ—ä¸­</li>
                    <li>æ¢è‡‚å‰åçš„æ¡¥è‡‚æ¯”è‡ªåŠ¨è®¾ç½®ä¸ºå€’æ•°å…³ç³»</li>
                    <li>Î”Râ‚“ç»¼åˆäº†æ£€æµè®¡(Î”n=0.2)å’Œç”µé˜»ç®±å„æ¡£ä½è¯¯å·®</li>
                    <li>Sâ‚çµæ•åº¦å¯è§†åŒ–å›¾è¡¨å°†æ ¹æ®è¾“å…¥æ•°æ®è‡ªåŠ¨æ›´æ–°</li>
                    <li>ç‚¹å‡»"é‡ç½®è¡¨æ ¼æ•°æ®"æŒ‰é’®å¯ä»¥æ¸…ç©ºæ‰€æœ‰è¾“å…¥æ•°æ®</li>
                </ol>
            </div>
            <!-- å°†å…¬å¼æ¨¡å—ç§»åˆ°ä½¿ç”¨è¯´æ˜å³ä¾§ -->
            <div class="formula-box">
                <h3>è®¡ç®—å…¬å¼</h3>
                <p class="formula">ğ‘†â‚ = n' / (Î”Râ‚ƒ' / Râ‚ƒ')</p>
                <p class="formula">ğ‘†â‚‚ = n'' / (Î”Râ‚ƒ'' / Râ‚ƒ'')</p>
                <p class="formula">Râ‚“ = âˆš(Râ‚ƒ Ã— Râ‚ƒ')</p>
                <p class="formula">Râ‚“=Râ‚“Â±Î”Râ‚“/Î©</p>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // åˆå§‹åŒ–å›¾è¡¨
            const ctx = document.getElementById('sensitivityChart').getContext('2d');
            let sensitivityChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'ğ‘†â‚çµæ•åº¦ (æ ¼/1%)',
                        data: [],
                        backgroundColor: 'rgba(66, 165, 245, 0.2)',
                        borderColor: 'rgba(66, 165, 245, 1)',
                        borderWidth: 3,
                        pointBackgroundColor: 'rgba(66, 165, 245, 1)',
                        pointRadius: 6,
                        pointHoverRadius: 8,
                        fill: true,
                        tension: 0.2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'ä¸åŒæ¡¥è‡‚æ¯”ä¸‹çš„ğ‘†â‚çµæ•åº¦å˜åŒ–',
                            font: {
                                size: 16,
                                color: '#1565c0'
                            }
                        },
                        legend: {
                            labels: {
                                color: '#0d47a1',
                                font: {
                                    size: 14
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'ğ‘†â‚çµæ•åº¦ (æ ¼/1%)',
                                color: '#1565c0'
                            },
                            grid: {
                                color: 'rgba(200, 200, 255, 0.2)'
                            },
                            ticks: {
                                color: '#0d47a1'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'æ¡¥è‡‚æ¯”',
                                color: '#1565c0'
                            },
                            grid: {
                                color: 'rgba(200, 200, 255, 0.2)'
                            },
                            ticks: {
                                color: '#0d47a1'
                            }
                        }
                    }
                }
            });

            // æ›´æ–°å›¾è¡¨å‡½æ•° - ä¿®æ”¹ä¸ºåŸºäºSâ‚
            function updateChart() {
                const rows = document.querySelectorAll('#measurement-table tbody tr');
                const labels = [];
                const s1Values = [];

                rows.forEach(row => {
                    const ratioCell = row.querySelector('.ratio-cell');
                    const s1Cell = row.querySelector('.s1');

                    if (ratioCell && s1Cell && s1Cell.textContent) {
                        labels.push(ratioCell.textContent.trim());
                        s1Values.push(parseFloat(s1Cell.textContent));
                    }
                });

                sensitivityChart.data.labels = labels;
                sensitivityChart.data.datasets[0].data = s1Values;
                sensitivityChart.update();
            }

            // è®¡ç®—ç”µé˜»ç®±è¯¯å·®E_R
            function calculateResistorError(r) {
                if (!r || r === 0) return 0;
                
                const digits = [
                    Math.floor(r / 1000) * 1000,
                    Math.floor((r % 1000) / 100) * 100,
                    Math.floor((r % 100) / 10) * 10,
                    Math.floor(r % 10),
                    Math.round((r % 1) * 10) / 10,
                    Math.round((r % 0.1) * 100) / 100
                ];
                
                const errors = [0.02, 0.02, 0.05, 0.2, 2, 5]; // å„æ¡£ä½è¯¯å·®ç™¾åˆ†æ¯”
                let deltaR = 0;
                
                digits.forEach((digit, index) => {
                    if (digit > 0) {
                        deltaR += parseFloat((digit * (errors[index] / 100)).toFixed(8));
                    }
                });
                
                return parseFloat((deltaR / r).toFixed(8)); // è¿”å›ç›¸å¯¹è¯¯å·®
            }

            // è®¡ç®—å•è¡Œæ•°æ®
            function calculateRow(row) {
                // æ¢è‡‚å‰çš„è¾“å…¥å€¼
                const r1Before = parseFloat(row.querySelector('.r1-before').value) || 0;
                const r2Before = parseFloat(row.querySelector('.r2-before').value) || 0;
                const r3Before = parseFloat(row.querySelector('.r3-before').value) || 0;
                const deltaR3Before = parseFloat(row.querySelector('.delta-r3-before').value) || 0;
                const nBefore = parseFloat(row.querySelector('.n-before').value) || 0;
                
                // æ¢è‡‚åçš„è¾“å…¥å€¼
                const r1After = parseFloat(row.querySelector('.r1-after').value) || 0;
                const r2After = parseFloat(row.querySelector('.r2-after').value) || 0;
                const r3After = parseFloat(row.querySelector('.r3-after').value) || 0;
                const deltaR3After = parseFloat(row.querySelector('.delta-r3-after').value) || 0;
                const nAfter = parseFloat(row.querySelector('.n-after').value) || 0;
                
                // ç»“æœå•å…ƒæ ¼
                const s1Cell = row.querySelector('.s1');
                const s2Cell = row.querySelector('.s2');
                const rxCell = row.querySelector('.rx');
                const rxFinalCell = row.querySelector('.rx-final');

                // è®¡ç®—ğ‘†â‚
                if (r3Before && deltaR3Before && nBefore && deltaR3Before !== 0) {
                    const s1 = parseFloat((nBefore / (deltaR3Before / r3Before)).toFixed(8));
                    s1Cell.textContent = formatNumber(s1);
                } else {
                    s1Cell.textContent = '';
                }

                // è®¡ç®—ğ‘†â‚‚
                if (r3After && deltaR3After && nAfter && deltaR3After !== 0) {
                    const s2 = parseFloat((nAfter / (deltaR3After / r3After)).toFixed(8));
                    s2Cell.textContent = formatNumber(s2);
                } else {
                    s2Cell.textContent = '';
                }

                // è®¡ç®—Rxå’Œç»¼åˆè¯¯å·®
                if (r3Before && r3After) {
                    const rx = parseFloat(Math.sqrt(r3Before * r3After).toFixed(8));
                    rxCell.textContent = formatNumber(rx);
                    
                    const s1 = parseFloat(s1Cell.textContent) || 0;
                    const s2 = parseFloat(s2Cell.textContent) || 0;
                    
                    if (s1 && s2) {
                        const s = parseFloat(Math.sqrt(s1 * s2).toFixed(8));
                        
                        if (s1 !== 0 && s2 !== 0 && rx) {
                            // 1. è®¡ç®—Î”Râ‚“' = (0.2/ğ‘†)/Râ‚“*0.01
                            const deltaRxPrime = parseFloat(((0.2 / s) / rx * 0.01).toFixed(8));
                            
                            // 2. è®¡ç®—æ¢è‡‚å‰çš„E_R
                            const E1_before = parseFloat(calculateResistorError(r1Before).toFixed(8));
                            const E2_before = parseFloat(calculateResistorError(r2Before).toFixed(8));
                            const E3_before = parseFloat(calculateResistorError(r3Before).toFixed(8));
                            const E_R_before = parseFloat(Math.sqrt(
                                Math.pow(E1_before, 2) + 
                                Math.pow(E2_before, 2) + 
                                Math.pow(E3_before, 2)
                            ).toFixed(8));
                            
                            // 3. è®¡ç®—æ¢è‡‚åçš„E_R
                            const E1_after = parseFloat(calculateResistorError(r1After).toFixed(8));
                            const E2_after = parseFloat(calculateResistorError(r2After).toFixed(8));
                            const E3_after = parseFloat(calculateResistorError(r3After).toFixed(8));
                            const E_R_after = parseFloat(Math.sqrt(
                                Math.pow(E1_after, 2) + 
                                Math.pow(E2_after, 2) + 
                                Math.pow(E3_after, 2)
                            ).toFixed(8));
                            
                            // 4. ç»¼åˆå¾—åˆ°ER= âˆš[E_Rï¼ˆå‰ï¼‰ *E_Rï¼ˆåï¼‰]
                            const ER = parseFloat(Math.sqrt(E_R_before * E_R_after).toFixed(8));
                            
                            // 5. è®¡ç®—Î”Râ‚“''=ER*Râ‚“
                            const deltaRxDoublePrime = parseFloat((ER * rx).toFixed(8));
                            
                            // 6. æœ€ç»ˆä¸ç¡®å®šåº¦ï¼šÎ”Râ‚“ = âˆš[Î”Râ‚“'Â² + Î”Râ‚“''Â²]
                            const deltaRxTotal = parseFloat(Math.sqrt(
                                Math.pow(deltaRxPrime, 2) + 
                                Math.pow(deltaRxDoublePrime, 2)
                            ).toFixed(8));
                            
                            rxFinalCell.textContent = `${formatNumber(rx)}Â±${formatNumber(deltaRxTotal)}`;
                        }
                    }
                }
                
                updateChart();
            }

            // æ ¼å¼åŒ–æ•°å­—ï¼Œæ˜¾ç¤ºæ—¶ä¿ç•™ä¸¤ä½å°æ•°
            function formatNumber(num) {
                if (isNaN(num)) return '';
                return parseFloat(num).toFixed(2);
            }

            // å…¨å±€R1è¾“å…¥æ¡†
            const globalR1Input = document.getElementById('global-r1');

            // ä¸ºå…¨å±€R1è¾“å…¥æ¡†æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
            globalR1Input.addEventListener('input', function() {
                const globalR1Value = parseFloat(this.value);
                if (isNaN(globalR1Value)) return;

                const rows = document.querySelectorAll('#measurement-table tbody tr');

                // æ›´æ–°æ‰€æœ‰è¡Œçš„R1-beforeå€¼å¹¶è®¡ç®—å¯¹åº”çš„R2-before
                rows.forEach(row => {
                    const r1Before = row.querySelector('.r1-before');
                    const r2Before = row.querySelector('.r2-before');
                    const r1After = row.querySelector('.r1-after');
                    const r2After = row.querySelector('.r2-after');
                    const ratioCell = row.querySelector('.ratio-cell');
                    const ratioText = ratioCell.textContent.trim();

                    // è®¾ç½®R1-beforeå€¼
                    r1Before.value = globalR1Value;

                    // æ ¹æ®æ¡¥è‡‚æ¯”è®¡ç®—R2-before
                    if (ratioText.includes(':')) {
                        const [left, right] = ratioText.split(':').map(Number);
                        const ratio = left / right;
                        const r2Value = parseFloat((globalR1Value / ratio).toFixed(8));
                        r2Before.value = r2Value;

                        // è‡ªåŠ¨å¡«å……æ¢è‡‚åçš„Râ‚å’ŒRâ‚‚ï¼ˆäº¤æ¢å€¼ï¼‰
                        r1After.value = r2Value;
                        r2After.value = globalR1Value;
                    }

                    // è§¦å‘è®¡ç®—
                    calculateRow(row);
                });

                // æ›´æ–°å›¾è¡¨
                updateChart();
            });

            // è·å–æ‰€æœ‰è¡Œ
            const rows = document.querySelectorAll('#measurement-table tbody tr');

            // ä¸ºæ¯è¡Œçš„è¾“å…¥æ¡†æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
            rows.forEach(row => {
                // æ¢è‡‚å‰çš„è¾“å…¥æ¡†
                const r1Before = row.querySelector('.r1-before');
                const r2Before = row.querySelector('.r2-before');

                // å½“æ¢è‡‚å‰çš„R1æˆ–R2å˜åŒ–æ—¶ï¼Œè‡ªåŠ¨å¡«å……æ¢è‡‚åçš„R2å’ŒR1
                r1Before.addEventListener('input', function() {
                    const r1After = row.querySelector('.r1-after');
                    const r2After = row.querySelector('.r2-after');
                    r2After.value = parseFloat(r1Before.value).toFixed(8);
                    calculateRow(row);
                });

                r2Before.addEventListener('input', function() {
                    const r1After = row.querySelector('.r1-after');
                    const r2After = row.querySelector('.r2-after');
                    r1After.value = parseFloat(r2Before.value).toFixed(8);
                    calculateRow(row);
                });

                // ä¸ºå…¶ä»–è¾“å…¥æ¡†æ·»åŠ è®¡ç®—äº‹ä»¶
                const inputs = row.querySelectorAll('input:not(.r1-before):not(.r2-before)');
                inputs.forEach(input => {
                    input.addEventListener('input', function() {
                        calculateRow(row);
                    });
                });
            });

            // é‡ç½®è¡¨æ ¼æ•°æ®å‡½æ•°
            function resetTableData() {
                // æ¸…ç©ºæµ‹é‡æ¡ä»¶
                document.getElementById('rough-value').value = '';
                document.getElementById('current-constant').value = '';
                document.getElementById('voltage').value = '';
                document.getElementById('global-r1').value = '';

                // æ¸…ç©ºæ‰€æœ‰è¾“å…¥æ¡†å’Œè®¡ç®—ç»“æœ
                const inputs = document.querySelectorAll('#measurement-table input');
                inputs.forEach(input => {
                    input.value = '';
                });

                const resultCells = document.querySelectorAll('.s1, .s2, .rx, .rx-final');
                resultCells.forEach(cell => {
                    cell.textContent = '';
                });

                // é‡ç½®å›¾è¡¨
                sensitivityChart.data.labels = [];
                sensitivityChart.data.datasets[0].data = [];
                sensitivityChart.update();
            }

            // ä¸ºé‡ç½®æŒ‰é’®æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
            document.getElementById('reset-button').addEventListener('click', resetTableData);
        });
    </script>
</body>
</html>
